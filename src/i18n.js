// src/i18n.js — simple, robust i18n with safe defaults

const STORAGE_KEY = 'tcf_lang';

// ----- Translations dictionary -----
const dict = {
  en: {
    // Header / top bar
    language: 'Language',
    scheme: 'Color scheme',

    // Home
    home: 'Home',
    chooseInterface: 'Home',
    clickToGo: 'Choose an interface to start',
    result: 'Result',
    copy: 'Copy',
    combineAll: 'Combine from all interfaces',
    orderInterfaces: 'Interfaces order',
    download: 'Download',
    clearSection: 'Clear section',
    clear: 'Clear',
    notAllRequired: 'Please fill all required fields',
    fillDefaults: 'Fill in default values',

    // Sidebar / Menu
    tools: 'Tools',

    // Admin / list
    adminPanel: 'Admin panel',
    adminTitle: 'WMS Interface Generator',
    overview: 'Overview',
    search: 'Search interface...',
    addInterface: 'Add interface',
    export: 'Export JSON',
    import: 'Import WMS (json)',
    importAddNew: 'Add new',
    importOverwriteSelected: 'Overwrite selected',
    category: 'Category',
    fieldsCount: 'Fields',
    deleteInterface: 'Delete interface',
    confirmDeleteInterface: 'Are you sure you want to delete this interface?',
    editInAdmin: 'Edit in admin',
    filterCat: 'Filter category',
    defaultValues: 'Default values',

    // Admin / editor
    tableOfContents: 'Table of contents',
    interface: 'Interface',
    number: 'Number',
    desc: 'Description',
    include: 'Include',
    addSection: 'Add section',
    fieldsTitle: 'Fields',
    sectionNumber: 'No.',
    renameSection: 'Rename section',
    description: 'Description',
    required: 'Required',
    alphanumeric: 'Alphanumeric',
    numeric: 'Numeric',
    addSeparator: 'Add separator',
    moveTo: 'Move to',
    delete: 'Delete',
    addField: 'Add field',
    backToList: 'Back to list',
    editInterface: 'Edit interface',
    maxLen: 'Max length',
    ifaceType: 'Type',
    io: 'I/O',
    renameCategory: 'Rename category',
    addCategory: 'Add category',
    fields: 'Fields',

    // Import/Export / Backup
    exportBackup: 'Export Backup',
    importBackup: 'Import Backup',
    invalidJson: 'Invalid JSON file.',
    importOk: 'Import completed.',
    backupOk: 'Backup imported.',
    exportOk: 'Export done.',
    importOneOk: 'Interface imported.',

    // Workspace
    workspaceProjects: 'Projekty',
    newWorkspace: 'New workspace',
    saveWorkspace: 'Save workspace',
    exportWorkspace: 'Export workspace',
    importWorkspace: 'Import workspace',
    deleteWorkspace: 'Delete workspace',
    currentWorkspace: 'Current workspace',
    workspaceName: 'Workspace name',
    workspaceSaved: 'Workspace saved',
workspaceApplied: "Workspace applied",
    autosave: 'Autosave',
    on: 'On',
    off: 'Off',
    apply: 'Apply',
clearColor: 'Clear color',
saveProjectChanges: 'Save project changes',
projectChangesSaved: 'Project changes saved',
workspaceCleared: 'Project cleared',
confirmNewWorkspace: 'Create a new project?',

    csvMode: 'CSV mode',
csvHeader: 'CSV header',
csvSep: 'Sep.',
csvSeparator: 'Separator',
jsonMode: 'JSON mode',
jsonArray: 'JSON as array',
minified: 'Minified',
onlyFilled: 'Only filled',
maxLenFlex: 'Max length: FLEX',

  },

  pl: {
    // Header / top bar
    language: 'Język',
    scheme: 'Schemat kolorów',

    // Home
    home: 'Strona główna',
    chooseInterface: 'Strona główna',
    clickToGo: 'Wybierz interfejs aby rozpocząć',
    result: 'Wynik',
    copy: 'Kopiuj',
    combineAll: 'Scal wynik z wielu interfejsów',
    orderInterfaces: 'Kolejność interfejsów',
    download: 'Pobierz',
    clearSection: 'Wyczyść sekcję',
    clear: 'Wyczyść',
    notAllRequired: 'Uzupełnij wszystkie wymagane pola',
    fillDefaults: 'Uzupełnij wartości podstawowe',

    // Sidebar / Menu
    tools: 'Narzędzia',

    // Admin / list
    adminPanel: 'Panel administracyjny',
    adminTitle: 'Generator Interfejsów WMS',
    overview: 'Przegląd',
    search: 'Szukaj interfejsu...',
    addInterface: 'Dodaj interfejs',
    export: 'Eksportuj JSON',
    import: 'Importuj WMS (json)',
    importAddNew: 'Dodaj nowy',
    importOverwriteSelected: 'Nadpisz wybrany',
    category: 'Kategoria',
    fieldsCount: 'Liczba pól',
    deleteInterface: 'Usuń interfejs',
    confirmDeleteInterface: 'Na pewno usunąć ten interfejs?',
    editInAdmin: 'Edytuj w panelu',
    filterCat: 'Filtruj kategorię',
    defaultValues: 'Wartości domyślne',

    // Admin / editor
    tableOfContents: 'Spis treści',
    interface: 'Interfejs',
    number: 'Numer',
    desc: 'Opis',
    include: 'Uwzględnij',
    addSection: 'Dodaj sekcję',
    fieldsTitle: 'Pola',
    sectionNumber: 'Nr',
    renameSection: 'Zmień nazwę sekcji',
    description: 'Opis',
    required: 'Wymagane',
    alphanumeric: 'Alfanumeryczne',
    numeric: 'Numeryczne',
    addSeparator: 'Dodaj separator',
    moveTo: 'Przenieś do',
    delete: 'Usuń',
    addField: 'Dodaj pole',
    backToList: 'Wróć do listy',
    editInterface: 'Edycja interfejsu',
    maxLen: 'Maks. długość',
    ifaceType: 'Typ',
    io: 'We/Wy',
    renameCategory: 'Zmień nazwę kategorii',
    addCategory: 'Dodaj kategorię',
    fields: 'Pola',

    // Import/Export / Backup
    exportBackup: 'Eksportuj Backup',
    importBackup: 'Importuj Backup',
    invalidJson: 'Nieprawidłowy plik JSON.',
    importOk: 'Import zakończony.',
    backupOk: 'Backup zaimportowany.',
    exportOk: 'Eksport zakończony.',
    importOneOk: 'Interfejs zaimportowany.',

    // Workspace
    workspaceProjects: 'Projekty',
    newWorkspace: 'Nowy projekt',
    saveWorkspace: 'Zapisz projekt',
    exportWorkspace: 'Eksportuj projekt',
    importWorkspace: 'Importuj projekt',
    deleteWorkspace: 'Usuń projekt',
    currentWorkspace: 'Aktualny projekt',
    workspaceName: 'Nazwa projektu',
    workspaceSaved: 'Projekt zapisany',
workspaceApplied: "Zastosowano projekt",
    autosave: 'Autosejw',
    on: 'Włączony',
    off: 'Wyłączony',
    apply: 'Zastosuj',
clearColor: 'Wyczyść kolor',
saveProjectChanges: 'Zapisz zmiany w projekcie',
projectChangesSaved: 'Zmiany w projekcie zapisane',
workspaceCleared: 'Projekt wyczyszczony',
confirmNewWorkspace: 'Utworzyć nowy projekt?',

    csvMode: 'Tryb CSV',
csvHeader: 'Nagłówek CSV',
csvSep: 'Sep.',
csvSeparator: 'Separator',
jsonMode: 'Tryb JSON',
jsonArray: 'JSON jako tablica',
minified: 'Zminifikowany',
onlyFilled: 'Tylko wypełnione',
maxLenFlex: 'Maks. długość: FLEX',

  },

  fr: {
    language: 'Langue',
    scheme: 'Schéma de couleurs',
    home: 'Accueil',
    chooseInterface: 'Accueil',
    clickToGo: 'Choisissez une interface pour commencer',
    result: 'Résultat',
    copy: 'Copier',
    download: 'Télécharger',
    clearSection: 'Vider la section',
    clear: 'Vider',
    notAllRequired: 'Veuillez remplir tous les champs obligatoires',
    tools: 'Outils',
    adminPanel: 'Panneau admin',
    adminTitle: 'Générateur d\'interfaces WMS',
    fillDefaults: 'Remplir les valeurs par défaut',
    overview: 'Aperçu',
    search: 'Rechercher une interface...',
    addInterface: 'Ajouter une interface',
    export: 'Exporter JSON',
    import: 'Importer JSON',
    importAddNew: 'Ajouter nouveau',
    importOverwriteSelected: 'Écraser la sélection',
    category: 'Catégorie',
    fieldsCount: 'Champs',
    deleteInterface: 'Supprimer l’interface',
    confirmDeleteInterface: 'Supprimer cette interface ?',
    editInAdmin: 'Modifier dans l’admin',
    filterCat: 'Filtrer la catégorie',
    defaultValues: 'Valeurs par défaut',
    tableOfContents: 'Sommaire',
    interface: 'Interface',
    number: 'Numéro',
    desc: 'Description',
    include: 'Inclure',
    addSection: 'Ajouter une section',
    fieldsTitle: 'Champs',
    sectionNumber: 'N°',
    renameSection: 'Renommer la section',
    description: 'Description',
    required: 'Obligatoire',
    alphanumeric: 'Alphanumérique',
    numeric: 'Numérique',
    addSeparator: 'Ajouter un séparateur',
    moveTo: 'Déplacer vers',
    delete: 'Supprimer',
    addField: 'Ajouter un champ',
    backToList: 'Retour à la liste',
    editInterface: 'Éditer l’interface',
    maxLen: 'Longueur max',
    ifaceType: 'Type',
    io: 'E/S',
    renameCategory: 'Renommer la catégorie',
    addCategory: 'Ajouter une catégorie',
    fields: 'Champs',
    exportBackup: 'Exporter la sauvegarde',
    importBackup: 'Importer la sauvegarde',
    invalidJson: 'Fichier JSON invalide.',
    importOk: 'Import terminé.',
    backupOk: 'Sauvegarde importée.',
    exportOk: 'Export terminé.',
    importOneOk: 'Interface importée.',
    workspaceProjects: 'Espace de travail',
    newWorkspace: 'Nouvel espace de travail',
    saveWorkspace: 'Enregistrer l’espace',
    exportWorkspace: 'Exporter l’espace',
    importWorkspace: 'Importer l’espace',
    deleteWorkspace: 'Supprimer l’espace',
    currentWorkspace: 'Espace courant',
    workspaceName: 'Nom de l’espace',
    workspaceSaved: 'Espace enregistré',
workspaceApplied: "Espace de travail appliqué",
    autosave: 'Sauvegarde auto',
    on: 'Activé',
    off: 'Désactivé',
    apply: 'Appliquer',
clearColor: 'Effacer la couleur',
saveProjectChanges: 'Enregistrer les modifications du projet',
projectChangesSaved: 'Modifications du projet enregistrées',
workspaceCleared: 'Projet réinitialisé',
confirmNewWorkspace: 'Créer un nouveau projet ?',
    csvMode: 'Mode CSV',
csvHeader: 'En-tête CSV',
csvSep: 'Sép.',
csvSeparator: 'Séparateur',
jsonMode: 'Mode JSON',
jsonArray: 'JSON en tableau',
minified: 'Minifié',
onlyFilled: 'Uniquement remplis',
maxLenFlex: 'Longueur max : FLEX',

  },

  cs: {
    language: 'Jazyk',
    scheme: 'Barevné schéma',
    home: 'Domů',
    chooseInterface: 'Domů',
    clickToGo: 'Vyberte rozhraní pro start',
    result: 'Výsledek',
    copy: 'Kopírovat',
    combineAll: 'Sloučit z více rozhraní',
    orderInterfaces: 'Pořadí rozhraní',
    download: 'Stáhnout',
    clearSection: 'Vymazat sekci',
    clear: 'Vymazat',
    notAllRequired: 'Vyplňte všechna povinná pole',
    tools: 'Nástroje',
    adminPanel: 'Admin panel',
    adminTitle: 'Generátor WMS rozhraní',
    overview: 'Přehled',
    search: 'Hledat rozhraní...',
    fillDefaults: 'Vyplnit výchozí hodnoty',
    addInterface: 'Přidat rozhraní',
    export: 'Export JSON',
    import: 'Import JSON',
    importAddNew: 'Přidat nové',
    importOverwriteSelected: 'Přepsat vybrané',
    category: 'Kategorie',
    fieldsCount: 'Počet polí',
    deleteInterface: 'Smazat rozhraní',
    confirmDeleteInterface: 'Opravdu smazat toto rozhraní?',
    editInAdmin: 'Upravit v adminu',
    filterCat: 'Filtrovat kategorii',
    defaultValues: 'Výchozí hodnoty',
    tableOfContents: 'Obsah',
    interface: 'Rozhraní',
    number: 'Číslo',
    desc: 'Popis',
    include: 'Zahrnout',
    addSection: 'Přidat sekci',
    fieldsTitle: 'Pole',
    sectionNumber: 'Č.',
    renameSection: 'Přejmenovat sekci',
    description: 'Popis',
    required: 'Povinné',
    alphanumeric: 'Alfanumerické',
    numeric: 'Numerické',
    addSeparator: 'Přidat oddělovač',
    moveTo: 'Přesunout do',
    delete: 'Smazat',
    addField: 'Přidat pole',
    backToList: 'Zpět na seznam',
    editInterface: 'Upravit rozhraní',
    maxLen: 'Max. délka',
    ifaceType: 'Typ',
    io: 'V/V',
    renameCategory: 'Přejmenovat kategorii',
    addCategory: 'Přidat kategorii',
    fields: 'Pole',
    exportBackup: 'Export zálohy',
    importBackup: 'Import zálohy',
    invalidJson: 'Neplatný JSON soubor.',
    importOk: 'Import dokončen.',
    backupOk: 'Záloha importována.',
    exportOk: 'Export dokončen.',
    importOneOk: 'Rozhraní importováno.',
    workspaceProjects: 'Pracovní prostor',
    newWorkspace: 'Nový workspace',
    saveWorkspace: 'Uložit workspace',
    exportWorkspace: 'Export workspace',
    importWorkspace: 'Import workspace',
    deleteWorkspace: 'Smazat workspace',
    currentWorkspace: 'Aktuální workspace',
    workspaceName: 'Název workspace',
    workspaceSaved: 'Workspace uložen',
workspaceApplied: "Pracovní prostor použit",
    autosave: 'Auto-uložení',
    on: 'Zapnuto',
    off: 'Vypnuto',
    apply: 'Použít',
clearColor: 'Vymazat barvu',
saveProjectChanges: 'Uložit změny v projektu',
projectChangesSaved: 'Změny v projektu uloženy',
workspaceCleared: 'Projekt vyčištěn',
confirmNewWorkspace: 'Vytvořit nový projekt?',
    csvMode: 'Režim CSV',
csvHeader: 'Hlavička CSV',
csvSep: 'Sep.',
csvSeparator: 'Oddělovač',
jsonMode: 'Režim JSON',
jsonArray: 'JSON jako pole',
minified: 'Minifikované',
onlyFilled: 'Jen vyplněná',
maxLenFlex: 'Max. délka: FLEX',

  },

  de: {
    language: 'Sprache',
    scheme: 'Farbschema',
    home: 'Startseite',
    chooseInterface: 'Startseite',
    clickToGo: 'Wähle ein Interface zum Starten',
    result: 'Ergebnis',
    copy: 'Kopieren',
    download: 'Herunterladen',
    clearSection: 'Abschnitt leeren',
    clear: 'Leeren',
    fillDefaults: 'Standardwerte ausfüllen',
    notAllRequired: 'Bitte alle Pflichtfelder ausfüllen',
    tools: 'Werkzeuge',
    adminPanel: 'Adminbereich',
    adminTitle: 'WMS-Schnittstellen-Generator',
    overview: 'Übersicht',
    search: 'Interface suchen...',
    addInterface: 'Interface hinzufügen',
    export: 'JSON exportieren',
    import: 'JSON importieren',
    importAddNew: 'Neu hinzufügen',
    importOverwriteSelected: 'Ausgewähltes überschreiben',
    category: 'Kategorie',
    fieldsCount: 'Felder',
    deleteInterface: 'Interface löschen',
    confirmDeleteInterface: 'Dieses Interface wirklich löschen?',
    editInAdmin: 'Im Admin bearbeiten',
    filterCat: 'Kategorie filtern',
    defaultValues: 'Standardwerte',
    tableOfContents: 'Inhaltsverzeichnis',
    interface: 'Interface',
    number: 'Nummer',
    desc: 'Beschreibung',
    include: 'Einbeziehen',
    addSection: 'Sektion hinzufügen',
    fieldsTitle: 'Felder',
    sectionNumber: 'Nr.',
    renameSection: 'Sektion umbenennen',
    description: 'Beschreibung',
    required: 'Pflichtfeld',
    alphanumeric: 'Alphanumerisch',
    numeric: 'Numerisch',
    addSeparator: 'Separator hinzufügen',
    moveTo: 'Verschieben nach',
    delete: 'Löschen',
    addField: 'Feld hinzufügen',
    backToList: 'Zurück zur Liste',
    editInterface: 'Interface bearbeiten',
    maxLen: 'Max. Länge',
    ifaceType: 'Typ',
    io: 'E/A',
    renameCategory: 'Kategorie umbenennen',
    addCategory: 'Kategorie hinzufügen',
    fields: 'Felder',
    exportBackup: 'Backup exportieren',
    importBackup: 'Backup importieren',
    invalidJson: 'Ungültige JSON-Datei.',
    importOk: 'Import abgeschlossen.',
    backupOk: 'Backup importiert.',
    exportOk: 'Export abgeschlossen.',
    importOneOk: 'Interface importiert.',
    workspaceProjects: 'Arbeitsbereich',
    newWorkspace: 'Neuer Workspace',
    saveWorkspace: 'Workspace speichern',
    exportWorkspace: 'Workspace exportieren',
    importWorkspace: 'Workspace importieren',
    deleteWorkspace: 'Workspace löschen',
    currentWorkspace: 'Aktueller Workspace',
    workspaceName: 'Workspace-Name',
    workspaceSaved: 'Workspace gespeichert',
workspaceApplied: "Arbeitsbereich angewendet",
    autosave: 'Autospeichern',
    on: 'An',
    off: 'Aus',
    apply: 'Übernehmen',
clearColor: 'Farbe zurücksetzen',
saveProjectChanges: 'Projektänderungen speichern',
projectChangesSaved: 'Projektänderungen gespeichert',
workspaceCleared: 'Projekt zurückgesetzt',
confirmNewWorkspace: 'Neues Projekt erstellen?',
    csvMode: 'CSV-Modus',
csvHeader: 'CSV-Kopfzeile',
csvSep: 'Sep.',
csvSeparator: 'Trennzeichen',
jsonMode: 'JSON-Modus',
jsonArray: 'JSON als Array',
minified: 'Minimiert',
onlyFilled: 'Nur ausgefüllte',
maxLenFlex: 'Max. Länge: FLEX',

  },
};

// ----- API -----
export function getLang() {
  try {
    const val = localStorage.getItem(STORAGE_KEY);
    return val || 'en';
  } catch (_) {
    return 'en';
  }
}

export function setLang(lang) {
  try {
    localStorage.setItem(STORAGE_KEY, lang);
  } catch (_) {}
  try {
    document.documentElement.setAttribute('lang', lang);
  } catch (_) {}
}

export function t(key) {
  const lang = getLang();
  const bundle = dict[lang] || dict.en;
  const v = (bundle && bundle[key]) || dict.en[key];
  if (typeof v === 'undefined') {
    try { console.warn('[i18n] Missing key:', key); } catch (_) {}
    return key;
  }
  return v;
}

// Optional helper to extend translations at runtime
export function setTranslations(lang, entries) {
  if (!dict[lang]) dict[lang] = {};
  const src = entries || {};
  for (const k in src) dict[lang][k] = src[k];
}

export function availableLangs() {
  return Object.keys(dict);
}
